<!DOCTYPE html>
<html>

<head>
    <title>by Max Malakhov</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f3460">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <base href="/">

    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=52007aca-39bd-4a9c-87ef-4d9b730aeb71"
        type="text/javascript"></script>

    <link rel="stylesheet" href="assets/css/main.css?v=139">
    <link rel="stylesheet" href="assets/css/special-fields.css">
    <link rel="stylesheet" href="assets/css/disabled-items.css">
</head>

<body>
    <!-- üî• –ú–ï–ù–Æ –õ–û–ì–ò–ù–ê -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <div class="login-header" style="text-align:center;">
                <div class="brand-container">
                    <img src="assets/img/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="brand-logo" />
                </div>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="userSelect">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <select id="userSelect">
                        <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="passwordInput">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <!-- üî• –ß–ï–ö–ë–û–ö–° –ó–ê–ü–û–ú–ù–ò–¢–¨ –ü–ê–†–û–õ–¨ -->
                <div class="remember-password">
                    <input type="checkbox" id="rememberPassword">
                    <label for="rememberPassword">üíæ –ó–∞–ø–æ–º–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</label>
                </div>
                <button class="login-button" onclick="login()">–í–æ–π—Ç–∏</button>
                <!-- üî• –ö–ù–û–ü–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ò–ù–°–ü–ï–ö–¢–û–†–û–í -->
                <button class="refresh-btn" onclick="refreshInspectorsList()">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤</button>
            </div>
        </div>
    </div>

    <!-- üî• –ì–ê–ú–ë–£–†–ì–ï–† –ú–ï–ù–Æ -->
    <button class="hamburger-btn" id="hamburgerBtn" onclick="toggleHamburgerMenu()">
        <span class="hamburger-icon">‚ò∞</span>
    </button>


    <!-- üî• –ú–û–î–ê–õ–¨–ù–û–ï –ú–ï–ù–Æ –ù–ê–í–ò–ì–ê–¶–ò–ò (–ö–ê–ö –ë–ê–õ–£–ù) -->
    <div class="nav-modal-overlay" id="navModalOverlay" onclick="closeHamburgerMenu()"></div>
    <div class="nav-modal" id="navModal">
        <!-- Header -->
        <div class="nav-modal-header-balloon">
            <div class="nav-header-left">
                <div class="nav-header-text">
                    <div class="nav-title">–ù–∞–≤–∏–≥–∞—Ü–∏—è</div>
                </div>
            </div>
            <button class="nav-modal-close-balloon" onclick="closeHamburgerMenu()">√ó</button>
        </div>

        <div class="nav-modal-content">
            <!-- Gray Info Box -->
            <div class="nav-info-box">
                <div class="nav-info-label">–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨</div>
                <div class="nav-user-name" id="navUserName">...</div>
                <div class="nav-info-label" style="margin-top: 8px;">–†–û–õ–¨</div>
                <div class="nav-user-role" id="navUserRole">...</div>
            </div>

            <!-- Buttons -->

            <button class="nav-modal-btn" onclick="selectNavItem('menu')">
                <span class="nav-icon">üìã</span>
                <span class="nav-text">–ú–µ–Ω—é</span>
            </button>

            <button class="nav-modal-btn" id="navBtnList" onclick="switchTab('objects'); toggleHamburgerMenu();">
                <span class="nav-icon">üìù</span>
                <span class="nav-text">–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</span>
            </button>

            <button class="nav-modal-btn" id="navBtnManagement"
                onclick="toggleInspectorsManagement(); toggleHamburgerMenu();">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</span>
            </button>

            <button class="nav-modal-btn" id="navBtnDashboards" onclick="openDashboardsApp(); toggleHamburgerMenu();">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">–î–∞—à–±–æ—Ä–¥—ã</span>
            </button>


            <button class="nav-modal-btn" id="navBtnWorkDay" onclick="toggleWorkDayFromNav(); toggleHamburgerMenu();"
                style="display: none;">
                <span class="nav-icon">üìÖ</span>
                <span class="nav-text">–û—Ç–∫—Ä—ã—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å</span>
            </button>

            <button class="nav-modal-btn nav-logout" onclick="logout()">
                <span class="nav-icon">üö™</span>
                <span class="nav-text">–í—ã–π—Ç–∏</span>
            </button>
        </div>
    </div>

    <!-- üî• –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° -->
    <div class="user-info" id="userInfo" style="display: none;">
        <span id="currentUser"></span>
        <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
    </div>

    <!-- üî• –ú–ï–ù–Æ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò–ù–°–ü–ï–ö–¢–û–†–ê–ú–ò -->
    <div class="inspector-management-menu" id="inspectorManagementMenu">
        <div class="inspector-management-header">
            <div class="filter-access-title" style="margin:0;">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞–º–∏</div>
            <button class="close-management-btn" onclick="closeTopMenu()">√ó</button>
        </div>

        <input type="text" class="search-management" id="searchManagement" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞–º..."
            onkeyup="filterManagementInspectors()">

        <div id="inspectorManagementContent"></div>
    </div>

    <!-- üî• –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- üî• –°–ê–ô–î–ë–ê–† –° –í–°–ï–ú–ò –≠–õ–ï–ú–ï–ù–¢–ê–ú–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
        <div class="sidebar" id="sidebar">
            <!-- üî• –ö–ù–û–ü–ö–ê –°–ö–†–´–¢–ò–Ø –°–ê–ô–î–ë–ê–†–ê -->
            <button class="sidebar-toggle" id="sidebarToggle" onclick="closeTopMenu()">‚óÄ</button>

            <div class="header">
                <button class="sidebar-close-btn" onclick="closeTopMenu()">‚úï</button>
                <div class="brand-container">
                    <img src="assets/img/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="brand-logo" />
                </div>
            </div>

            <!-- üî• –°–ï–ö–¶–ò–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –†–ê–ë–û–ß–ò–ú –î–ù–ï–ú (–î–õ–Ø –ò–ù–°–ü–ï–ö–¢–û–†–û–í) -->
            <div class="control-section" id="workDaySection" style="display: none;">
                <div class="control-section-title">üìÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏–º –¥–Ω–µ–º</div>
                <div class="control-buttons-grid">
                    <button class="inspector-btn" id="openDayBtn" onclick="startWorkDay()">–û—Ç–∫—Ä—ã—Ç—å –¥–µ–Ω—å</button>
                    <button class="inspector-btn close-day-btn" id="closeDayBtn" onclick="endWorkDay()" disabled>–ó–∞–∫—Ä—ã—Ç—å
                        –¥–µ–Ω—å</button>
                </div>
                <div class="work-day-indicator closed" id="workDayIndicator">–°—Ç–∞—Ç—É—Å: –î–µ–Ω—å –∑–∞–∫—Ä—ã—Ç</div>
            </div>

            <!-- üî• –°–ï–ö–¶–ò–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê -->
            <div class="control-section" id="adminSection" style="display: none;">
                <div class="control-section-title">‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</div>
                <div class="control-buttons-grid">
                    <button class="admin-btn" onclick="toggleInspectorsHomes()">–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä—ã</button>
                    <button class="admin-btn" id="managementBtn"
                        onclick="toggleInspectorsManagement()">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
                    <button class="admin-btn" onclick="openAddObjectList()">–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</button>
                    <button class="admin-btn dashboard-wide" id="adminDashboardBtn"
                        onclick="openDashboardsApp()">–î–∞—à–±–æ—Ä–¥—ã</button>
                </div>
            </div>

            <!-- üî• –¢–ê–ë–´ -->
            <div class="tab-buttons" id="sidebarTabs">
                <button class="tab-button active" onclick="switchTab('filters')">–§–∏–ª—å—Ç—Ä—ã</button>
                <button class="tab-button" onclick="switchTab('objects')">–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</button>
            </div>

            <div class="tab-content">
                <!-- üî• –í–ö–õ–ê–î–ö–ê –§–ò–õ–¨–¢–†–û–í -->
                <div class="tab-pane active" id="filters-tab">
                    <div class="filter-section">
                        <div class="filter-title">üîç –ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–∞</div>
                        <input type="text" id="searchInput" class="search-box"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–æ—á–∫–∏ –∏–ª–∏ –∞–¥—Ä–µ—Å..." onkeyup="updateFilters()">
                    </div>

                    <div class="filter-section">
                        <div class="filter-title">üë§ –§–∏–ª—å—Ç—Ä –ø–æ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞–º</div>
                        <input type="text" id="searchInspectors" class="search-box"
                            placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞–º..." onkeyup="filterInspectorsList()">
                        <div class="checkbox-item" style="margin-bottom: 12px; font-weight: bold;">
                            <input type="checkbox" id="selectAllInspectorsCheckbox"
                                onchange="toggleAllInspectors(this.checked); saveFilterState();">
                            <label for="selectAllInspectorsCheckbox">–í—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ</label>
                        </div>
                        <div class="checkbox-group" id="inspectorsList">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–æ–≤...</div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <div class="filter-title">üìã –§–∏–ª—å—Ç—Ä –ø–æ —Å–ø–∏—Å–∫–∞–º</div>
                        <div class="checkbox-item" style="margin-bottom: 12px; font-weight: bold;">
                            <input type="checkbox" id="selectAllListsCheckbox"
                                onchange="toggleAllLists(this.checked); saveFilterState();">
                            <label for="selectAllListsCheckbox">–í—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ</label>
                        </div>
                        <div class="checkbox-group" id="listsList">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–æ–≤...</div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <div class="filter-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="showHidden" onchange="updateFilters(); saveFilterState();">
                            <label for="showHidden"> –ú–û–ù–ò–¢–û–†–ò–ù–ì –ó–ê–í–ï–†–®–ï–ù ‚úÖ </label>
                        </div>
                    </div>

                    <div class="stats">
                        <!-- üî• –¢–û–õ–¨–ö–û –û–î–ù–ê –ö–ù–û–ü–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø -->
                        <button class="refresh-btn force" onclick="forceRefreshData()">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ
                            –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
                        <div>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</div>
                        <div id="objectsCounter">–ü–æ–∫–∞–∑–∞–Ω–æ: 0 –∏–∑ 0 –æ–±—ä–µ–∫—Ç–æ–≤</div>
                        <div id="completedCounter">–í—ã–ø–æ–ª–Ω–µ–Ω–æ: 0 –æ–±—ä–µ–∫—Ç–æ–≤</div>
                        <div id="activeCounter" style="margin-top: 5px; font-size: 12px; color: #3498db;"></div>
                    </div>
                </div>

                <!-- üî• –í–ö–õ–ê–î–ö–ê –°–ü–ò–°–ö–ê –û–ë–™–ï–ö–¢–û–í -->
                <div class="tab-pane" id="objects-tab">
                    <div class="filter-section">
                        <div class="filter-title">üîç –ü–æ–∏—Å–∫ –≤ —Å–ø–∏—Å–∫–µ</div>
                        <input type="text" id="searchListInput" class="search-box"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–æ—á–∫–∏ –∏–ª–∏ –∞–¥—Ä–µ—Å..." onkeyup="updateObjectsList()">
                    </div>
                    <div class="objects-list">
                        <div class="objects-list-title">üìã –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</div>
                        <div id="objectsListContent">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="map-container">
            <div id="map"></div>
        </div>
    </div>

    <div class="object-details hidden" id="objectDetailsOverlay">
        <div class="object-details__backdrop"></div>
        <div class="object-details__card" role="dialog" aria-modal="true">
            <button class="object-details__close" type="button" onclick="closeObjectDetails()">‚úï</button>
            <div class="object-details__content" id="objectDetailsContent"></div>
        </div>
    </div>

    <div class="workday-modal hidden" id="workDayApprovalOverlay">
        <div class="workday-modal__backdrop"></div>
        <div class="workday-modal__card" role="dialog" aria-modal="true">
            <button class="workday-modal__close" type="button" onclick="closeWorkDayApproval()">‚úï</button>
            <div class="workday-modal__content" id="workDayApprovalContent"></div>
        </div>
    </div>

    <!-- üî• –í–´–ï–ó–ñ–ê–Æ–©–ï–ï –ú–ï–ù–Æ –°–ü–ò–°–ö–ê –û–ë–™–ï–ö–¢–û–í (add_object) -->
    <div class="side-drawer" id="addObjectDrawer">
        <div class="side-drawer-header">
            <div class="side-drawer-title">–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</div>
            <button class="side-drawer-close" onclick="closeAddObjectDrawer()">√ó</button>
        </div>
        <div class="side-drawer-search">
            <input type="text" id="addObjectSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –∞–¥—Ä–µ—Å—É..."
                oninput="filterAddObjectList(this.value)">
        </div>
        <div class="side-drawer-content" id="addObjectListContent">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤...</div>
        </div>
    </div>

    <script src="assets/js/checklist.js?t=1766682000"></script>
    <script type="module" src="assets/js/upload-queue.js"></script>
    <script type="module" src="assets/js/main.js?t=1766682000"></script>
    <!-- Note: app.js is imported by main.js as ES6 module -->
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available
                                    if (confirm('–î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–±–Ω–æ–≤–∏—Ç—å?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>